# Enterprise-Grade API Automation Testing Framework

ä¸€ä¸ªåŸºäº Python æŠ€æœ¯æ ˆæ„å»ºçš„é«˜åº¦çµæ´»ã€æ•°æ®é©±åŠ¨çš„ä¼ä¸šçº§APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€‚è¯¥æ¡†æ¶å°†"æµ‹è¯•é€»è¾‘"ã€"æµ‹è¯•æµç¨‹"ä¸"æµ‹è¯•æ•°æ®"å½»åº•åˆ†ç¦»ï¼Œæ—¨åœ¨æå‡æµ‹è¯•ç”¨ä¾‹çš„å¯ç»´æŠ¤æ€§ã€å¤ç”¨æ€§å’Œæ‰©å±•æ€§ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### âœ¨ å®Œå…¨æ•°æ®é©±åŠ¨

- æ‰€æœ‰æµ‹è¯•å…ƒç´ ï¼ˆç¯å¢ƒã€ç”¨ä¾‹ã€æ­¥éª¤ã€å‚æ•°ã€æ–­è¨€ï¼‰å‡å­˜å‚¨äºæ•°æ®åº“ï¼ˆPostgreSQLï¼‰
- é…ç½®å³æµ‹è¯•ï¼Œæ— éœ€ç¼–å†™ä»£ç å³å¯åˆ›å»ºå’Œç®¡ç†æµ‹è¯•ç”¨ä¾‹

### ğŸ—ï¸ åˆ†å±‚ç”¨ä¾‹ç®¡ç†

- é€šè¿‡ `Service -> Module -> Component` çš„ç»“æ„åŒ–å±‚çº§ç»„ç»‡æµ‹è¯•ç”¨ä¾‹
- æ”¯æŒå¤§è§„æ¨¡æµ‹è¯•ç”¨ä¾‹çš„æ¸…æ™°åˆ†ç±»å’Œç®¡ç†

### ğŸ” å¼ºå¤§çš„ç­›é€‰ä¸æ‰§è¡Œ

- æ”¯æŒé€šè¿‡å‘½ä»¤è¡ŒæŒ‰æœåŠ¡ã€æ¨¡å—ã€ç»„ä»¶ã€æ ‡ç­¾ã€Jira IDç­‰ä»»æ„ç»´åº¦åŠ¨æ€ç­›é€‰
- çµæ´»çš„æµ‹è¯•æ‰§è¡Œç­–ç•¥ï¼Œæ”¯æŒå¹¶è¡Œæ‰§è¡Œ

### ğŸ”„ åŠ¨ä½œ/æ­¥éª¤å¤ç”¨

- é€šè¿‡"å…±äº«åŠ¨ä½œ"(shared_actions)æœºåˆ¶å®ç°å…¬å…±æ“ä½œçš„ä¸€æ¬¡å®šä¹‰ã€å¤„å¤„å¼•ç”¨
- éµå¾ªDRYåŸåˆ™ï¼Œæå¤§æå‡ç”¨ä¾‹å¯ç»´æŠ¤æ€§

### ğŸ“Š é«˜çº§å‚æ•°åŒ–

- æµ‹è¯•æ¨¡æ¿ä¸æ•°æ®é›†åˆ†ç¦»ï¼Œè½»æ¾å®ç°åŒä¸€ä¸šåŠ¡æµç¨‹çš„å¤šåœºæ™¯ã€å¤šæ•°æ®è¦†ç›–
- æ”¯æŒä¸ºç‰¹å®šåœºæ™¯å®šä¹‰ç‹¬ç‰¹çš„æœŸæœ›ç»“æœ

### âœ… ç»Ÿä¸€å…³é”®å­—é©±åŠ¨æ–­è¨€å¼•æ“

- éªŒè¯è§„åˆ™é‡‡ç”¨ç»Ÿä¸€çš„JSONå¯¹è±¡æ ¼å¼
- æ”¯æŒçŠ¶æ€ç ã€å“åº”ä½“åŒ¹é…ã€æ–‡æœ¬åŒ…å«ã€JSONPathéªŒè¯ç­‰å¤šç§æ–­è¨€æ–¹å¼
- å…¼å…·æ˜“ç”¨æ€§ä¸å¼ºå¤§çš„åŠŸèƒ½æ€§

### ğŸ“ˆ ä¼ä¸šçº§æŠ¥å‘Š

- æ·±åº¦é›†æˆAllureï¼Œä¸ºæ¯ä¸ªæ­¥éª¤ã€è¯·æ±‚ã€å“åº”ã€æ–­è¨€ã€å˜é‡æå–ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
- å±‚çº§æ¸…æ™°çš„æµ‹è¯•æ‰§è¡Œè½¨è¿¹

### ğŸŒ æµ‹è¯•å³æœåŠ¡ (TaaS)

- å†…ç½®FastAPIæœåŠ¡ï¼Œå¯é€šè¿‡APIè°ƒç”¨æ¥è¿œç¨‹è§¦å‘æµ‹è¯•ä»»åŠ¡

### ğŸŒ çµæ´»çš„ç¯å¢ƒç®¡ç†

- æ”¯æŒå¤šå¥—æµ‹è¯•ç¯å¢ƒï¼ˆdevã€uatï¼‰çš„æ— ç¼åˆ‡æ¢

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
auto_test/
â”œâ”€â”€ api/                  # TaaSæœåŠ¡ (FastAPI)
â”œâ”€â”€ core/                 # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ api_client.py     # APIå®¢æˆ·ç«¯å’Œæ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ assertion_engine.py # æ–­è¨€å¼•æ“
â”‚   â”œâ”€â”€ context_manager.py # æµ‹è¯•ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”œâ”€â”€ db_handler.py     # æ•°æ®åº“æ“ä½œ
â”‚   â””â”€â”€ result_writer.py  # ç»“æœå†™å…¥
â”œâ”€â”€ models/               # SQLAlchemy ORMæ¨¡å‹
â”‚   â””â”€â”€ tables.py         # æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰
â”œâ”€â”€ tests/                # Pytestæµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ conftest.py       # Pytesté…ç½®
â”‚   â””â”€â”€ test_main.py      # ä¸»æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ utils/                 # å·¥å…·ç±»
â”‚   â””â”€â”€ placeholder_parser.py # å ä½ç¬¦è§£æå™¨
â”œâ”€â”€ database/              # æ•°æ®åº“ç›¸å…³æ–‡ä»¶
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ reports/               # AllureæŠ¥å‘Šç›®å½•
â”œâ”€â”€ requirements.txt       # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ run.py                 # å‘½ä»¤è¡Œæ‰§è¡Œå…¥å£
â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡é…ç½®
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### `api_auto_cases` - æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

- å®šä¹‰æµ‹è¯•æµç¨‹çš„å®è§‚å±æ€§ï¼ˆåç§°ã€æœåŠ¡ã€æ¨¡å—ã€ç»„ä»¶ç­‰ï¼‰
- æ”¯æŒæ ‡ç­¾åˆ†ç±»å’Œä½œè€…ä¿¡æ¯

#### `case_data_sets` - æ•°æ®é›†

- ä¸ºæ¯ä¸ªç”¨ä¾‹æ¨¡æ¿æä¾›å…·ä½“çš„æµ‹è¯•æ•°æ®
- æ”¯æŒå˜é‡æ³¨å…¥å’ŒéªŒè¯è§„åˆ™è¦†ç›–
- å¯å…³è”Jira IDå®ç°éœ€æ±‚è¿½æº¯

#### `api_actions` - æµ‹è¯•æ­¥éª¤

- å®šä¹‰å…·ä½“çš„APIè¯·æ±‚æ­¥éª¤
- æ”¯æŒå¼•ç”¨å…±äº«åŠ¨ä½œæ¨¡æ¿
- åŒ…å«è¯·æ±‚å‚æ•°ã€éªŒè¯è§„åˆ™å’Œè¾“å‡ºæå–

#### `shared_actions` - å…±äº«åŠ¨ä½œæ¨¡æ¿

- å­˜å‚¨å¯å¤ç”¨çš„å…¬å…±æ“ä½œï¼ˆå¦‚ç™»å½•ã€è®¤è¯ç­‰ï¼‰
- ä¸€æ¬¡å®šä¹‰ï¼Œå¤šå¤„å¼•ç”¨

#### `test_environments` - æµ‹è¯•ç¯å¢ƒ

- ç®¡ç†ä¸åŒç¯å¢ƒçš„é…ç½®ä¿¡æ¯
- æ”¯æŒç¯å¢ƒç‰¹å®šçš„æ•°æ®åº“è¿æ¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd auto_test

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®åº“é…ç½®

```bash
# åˆ›å»º.envæ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
DB_HOST=localhost
DB_PORT=5432
DB_NAME=test_framework
DB_USER=your_username
DB_PASSWORD=your_password
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

```sql
-- æ‰§è¡ŒSQLè„šæœ¬åˆ›å»ºè¡¨ç»“æ„
-- å‚è€ƒ models/tables.py ä¸­çš„è¡¨å®šä¹‰
```

### 4. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python run.py

# æŒ‰æœåŠ¡ç­›é€‰
python run.py --service "User Management"

# æŒ‰æ ‡ç­¾ç­›é€‰
python run.py --tags "P0,smoke"

# æŒ‰Jira IDç­›é€‰
python run.py --jira "PROJ-456"

# æŒ‡å®šç¯å¢ƒ
python run.py --env staging

# å¹¶è¡Œæ‰§è¡Œ
python run.py --parallel 4
```

## ğŸ“ ä½¿ç”¨æŒ‡å—

### åˆ›å»ºæµ‹è¯•ç”¨ä¾‹

#### 1. å®šä¹‰å…±äº«åŠ¨ä½œï¼ˆå¯é€‰ï¼‰
```sql
INSERT INTO shared_actions (name, description, api_url_path, http_method, headers, body, validations) 
VALUES (
    'user_login',
    'ç”¨æˆ·ç™»å½•æ“ä½œ',
    '/api/auth/login',
    'POST',
    '{"Content-Type": "application/json"}',
    '{"username": "{{username}}", "password": "{{password}}"}',
    '{"expectedStatusCode": 200, "containsText": "token"}'
);
```

#### 2. åˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿
```sql
INSERT INTO api_auto_cases (name, service, module, component, tags) 
VALUES (
    'ç”¨æˆ·æ³¨å†Œæµç¨‹æµ‹è¯•',
    'User Management',
    'Authentication',
    'Registration',
    ARRAY['P0', 'smoke']
);
```

#### 3. å®šä¹‰æµ‹è¯•æ­¥éª¤
```sql
INSERT INTO api_actions (case_id, step_order, description, api_url_path, http_method, headers, body, validations) 
VALUES (
    1, 1, 'ç”¨æˆ·æ³¨å†Œ',
    '/api/users/register',
    'POST',
    '{"Content-Type": "application/json"}',
    '{"username": "{{username}}", "email": "{{email}}", "password": "{{password}}"}',
    '{"expectedStatusCode": 201, "notNull": ["$.id", "$.username"]}'
);
```

#### 4. åˆ›å»ºæ•°æ®é›†
```sql
INSERT INTO case_data_sets (case_id, data_set_name, variables, validations_override, jira_id) 
VALUES (
    1, 'æ­£å¸¸æ³¨å†Œåœºæ™¯',
    '{"username": "testuser", "email": "test@example.com", "password": "password123"}',
    '{"1": {"expectedStatusCode": 201, "containsText": "success"}}',
    'PROJ-123'
);
```

### é«˜çº§åŠŸèƒ½

#### å˜é‡æ³¨å…¥å’Œä¸Šä¸‹æ–‡
- ä½¿ç”¨ `{{@variable_name}}` å¼•ç”¨æ•°æ®é›†ä¸­çš„å˜é‡
- ä½¿ç”¨ `{{step_name.field}}` å¼•ç”¨ä¹‹å‰æ­¥éª¤çš„å“åº”æ•°æ®

#### éªŒè¯è§„åˆ™è¦†ç›–
- åœ¨æ•°æ®é›†ä¸­é€šè¿‡ `validations_override` å­—æ®µè¦†ç›–é»˜è®¤éªŒè¯è§„åˆ™
- æ”¯æŒæ­¥éª¤çº§åˆ«çš„éªŒè¯è§„åˆ™å®šåˆ¶

#### å¹¶è¡Œæ‰§è¡Œ
```bash
# ä½¿ç”¨æ‰€æœ‰å¯ç”¨CPUæ ¸å¿ƒ
python run.py --parallel auto

# æŒ‡å®šè¿›ç¨‹æ•°
python run.py --parallel 8
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### AllureæŠ¥å‘Š
- è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š
- åŒ…å«æ¯ä¸ªæ­¥éª¤çš„è¯·æ±‚/å“åº”è¯¦æƒ…
- æ”¯æŒæµ‹è¯•ç»“æœçš„å†å²è¶‹åŠ¿åˆ†æ

### æŠ¥å‘ŠæŸ¥çœ‹
```bash
# å¯åŠ¨AllureæœåŠ¡ï¼ˆè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼‰
python run.py

# ç”Ÿæˆé™æ€æŠ¥å‘Š
allure generate reports/allure-results -o reports/allure-report --clean
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
- `TEST_ENV`: æµ‹è¯•ç¯å¢ƒåç§°
- `PYTEST_PARALLEL_WORKERS`: å¹¶è¡Œæ‰§è¡Œçš„å·¥ä½œè¿›ç¨‹æ•°

### å‘½ä»¤è¡Œå‚æ•°
- `--env`: æŒ‡å®šæµ‹è¯•ç¯å¢ƒ
- `--service`: æŒ‰æœåŠ¡ç­›é€‰
- `--module`: æŒ‰æ¨¡å—ç­›é€‰
- `--component`: æŒ‰ç»„ä»¶ç­›é€‰
- `--tags`: æŒ‰æ ‡ç­¾ç­›é€‰
- `--jira`: æŒ‰Jira IDç­›é€‰
- `--id`: æŒ‰ç”¨ä¾‹IDæ‰§è¡Œ
- `--parallel`: å¹¶è¡Œæ‰§è¡Œé…ç½®
- `--debug-mode`: è°ƒè¯•æ¨¡å¼

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### åŸºç¡€APIæµ‹è¯•
```python
# æµ‹è¯•ç”¨ä¾‹ä¼šè‡ªåŠ¨ä»æ•°æ®åº“åŠ è½½å¹¶æ‰§è¡Œ
# æ— éœ€ç¼–å†™Pythonä»£ç ï¼Œå®Œå…¨é€šè¿‡æ•°æ®åº“é…ç½®é©±åŠ¨
```

### å¤æ‚ä¸šåŠ¡æµç¨‹æµ‹è¯•
```python
# æ”¯æŒå¤šæ­¥éª¤ã€å¤šæ•°æ®é›†çš„å¤æ‚æµ‹è¯•åœºæ™¯
# é€šè¿‡å…±äº«åŠ¨ä½œå®ç°æ­¥éª¤å¤ç”¨
# æ”¯æŒæ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯é€»è¾‘
```

## ğŸš§ å¼€å‘è®¡åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] JiraåŒå‘é›†æˆï¼šæµ‹è¯•ç»“æŸåè‡ªåŠ¨å›å†™ç»“æœ
- [ ] å‰ç«¯ç®¡ç†ç•Œé¢ï¼šWebç•Œé¢ç®¡ç†æµ‹è¯•ç”¨ä¾‹
- [ ] æ€§èƒ½æµ‹è¯•é›†æˆï¼šæ”¯æŒLocustå‹æµ‹

### é•¿æœŸç›®æ ‡
- [ ] ç§»åŠ¨ç«¯æµ‹è¯•æ”¯æŒ
- [ ] å¾®æœåŠ¡æµ‹è¯•ä¼˜åŒ–
- [ ] AIé©±åŠ¨çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…ï¼š[Hellen]
- é‚®ç®±ï¼š[774804075@qq.com]
- é¡¹ç›®é“¾æ¥ï¼š[https://github.com/username/auto_test](https://github.com/username/auto_test)



**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„æµ‹è¯•æ¡†æ¶ï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯ã€‚
